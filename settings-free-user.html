<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/settings-free-user.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto Mono:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Sue Ellen Francisco:wght@400&display=swap"
    />
    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="js/resetpassword.js"type="text/javascript"></script>
  </head>
  <body>
    <div class="settings-free-user">
      <div class="settings">Settings</div>
      <div class="button6">
        <a href="/"><div class="update-property">Back</div></a>
      </div>
      <div class="account">Account</div>
      <div class="notifications">Notifications</div>
      <div style="cursor:pointer;" onclick="onDelete();"class="delete-account">Delete Account</div>
      <div class="card9"></div>
      <div class="card10">
        <div class="toggle2">
          <div class="toggle3">
            <div class="frame2"></div>
            <div class="circle2"></div>
          </div>
          <div class="on1">Email group b</div>
        </div>
        <div class="toggle4">
          <div class="toggle3">
            <div class="frame3"></div>
            <div class="circle3"></div>
          </div>
          <div class="on1">Email group A</div>
        </div>
      </div>
      <div id="static_name"class="input">
        <img class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label1">Name</div>
      </div>

      <!-- created an name input tag when edit button is clicked -->
      <div id="input_name"style="display:none;"class="input">
        <input style="color:black;"id="username"type="text"name="username"class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label1">Name</div>
      </div>
<!--  -->
      <div id="static_email"class="input1">
        <img class="rectangle-icon9" alt=""  />

        <div id="default_email"class="input-text1"></div>
        <div class="label2">Email Address</div>
      </div>
      <!--  -->
      <div id="input_email"style="display:none;"class="input1"">
        <input style="color:black;"name="email"type="email" id="email"class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label2">Email Address</div>
      </div>

      <!--  -->
      <div class="input2">
        <img class="rectangle-icon9" alt=""  />

        <div  class="input-text1">***********</div>
        <div class="label2">Password</div>
      </div>
      <div class="name">Name</div>
      
      <div id="edit_name" class="button7 ">
        
        <div  class="update-property">Edit </div>
      </div>
      <div onclick="onSubmitName()" style="display:none;" id="submit_name" class="button7">
        <div  class="update-property-submit">Submit </div>
      </div>
      <a onclick="passwordReset();" href="./password-reset1.html">

      <div class="button8">
        <div class="update-property">Reset</div>
      </div></a>
      <div id="edit_email" class="button9">
        <div class="update-property">Edit </div>
      </div>
      <div onclick="onSubmitEmail()" style="display:none;" id="submit_email" class="button9">
        <div  class="update-property-submit">Submit</div>
      </div>
    </div>
    <script>
      var default_name=document.getElementById('default_name')
      var default_email=document.getElementById("default_email")
      var curName=window.localStorage.getItem('username')
      var curEmail=window.localStorage.getItem('user_email')
      default_name.textContent=curName
      default_email.textContent=curEmail


      var edit_name=document.getElementById('edit_name')
      var edit_email=document.getElementById('edit_email')

      var static_name=document.getElementById('static_name')
      var input_name=document.getElementById('input_name')
      var static_email=document.getElementById('static_email')
      var input_email=document.getElementById('input_email')
      var submit_name=document.getElementById('submit_name')
      var submit_email=document.getElementById('submit_email')
      var username=document.getElementById("username")
      var email=document.getElementById("email")
      username.value=curName
      email.value=curEmail
      edit_name.addEventListener('click',function(){
        input_name.style.display='block'
        static_name.style.display='none'
        edit_name.style.display='none'
        submit_name.style.display='block'
      
      })
      edit_email.addEventListener('click',function(){
        input_email.style.display='block'
        static_email.style.display='none'
        edit_email.style.display='none'
        submit_email.style.display='block'
      
      })
      function onSubmitEmail(){
        var currentemail =window.localStorage.getItem('user_email')
        var newEmail=email.value
       

   
    $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/edit_email/',
    data: {'newemail':newEmail,'user_email':currentemail},
    dataType: "text",
    success: function (response) {
      
      parse_response = $.parseJSON(response)
      console.log(parse_response)
      success=parse_response['success']
     if (!success){
      alert(parse_response['msg'])
      return 
     }
            user_email = parse_response["user_email"]
            
window.localStorage.setItem('user_email',user_email)
window.location.replace('/')
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
      alert("Faced some error:",msg)
    }
    
});
      }
      function onSubmitName(){
        var currentuser=window.localStorage.getItem('username')
        var newusername=username.value
        
 
    $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/edit_name/',
    data: {'newusername':newusername,'username':currentuser},
    dataType: "text",
    success: function (response) {
      parse_response = $.parseJSON(response)
      console.log(parse_response)
      success=parse_response['success']
     if (!success){
      alert(parse_response['msg'])
      return 
     }
      username = parse_response["username"]
      window.localStorage.setItem('username',username)
      window.location.replace('/')
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
      alert("Faced some error:",msg)
    }
    
});
      }

      function onDelete(){
        $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/delete/',
    data: {'email':window.localStorage.getItem('user_email')},
    dataType: "text",
    success: function (response) {
      window.localStorage.clear()
      window.location.replace('/')
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
      alert("Faced some error:",msg)
    }
    
});
      }
    </script>
  </body>
</html>
