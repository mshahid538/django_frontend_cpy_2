<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/settings-free-user.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto Mono:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Sue Ellen Francisco:wght@400&display=swap"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="js/resetpassword.js"type="text/javascript"></script>
  </head>
  <body>
    <div class="toast-container position-fixed top-0 end-0 p-3">
      <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"data-bs-delay="3000">
        <div class="toast-header">
          
          <strong class="me-auto"></strong>
          <small class="text-danger"></small>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div id="toastbody" class=" toast-body">
          
        </div>
      </div>
    </div>


    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <p>Delete Account</p>
        <form>
          <label for="password">Your Password:</label><br>
          <input id="password" style="width:75%;" placeholder="Password"class="form-control" type="password" name="password" />
          <label for="confirmpassword">Confirm Password:</label><br>

          <input id="confirmpassword" style="width:75%;" placeholder="Confirm Password"class="form-control" type="password" name="password" />
<br>
          <div id="liveToastBtn2" style="text-align:center;"><div style="text-align:center;" onclick="onDelete();" class="btn btn-primary">Remove Account</div></div>
          
        </form>
      </div>
    
    </div>
    <div class="settings-free-user">

      <div class="settings">Settings</div>
      <div class="button6">
        <a href="/"><div class="update-property">Back</div></a>
      </div>
      <div class="account">Account</div>
      <div class="notifications">Notifications</div>
      <div id="myBtn" style="cursor:pointer;" class="delete-account">Delete Account</div>
      <div class="card9"></div>
    
      <div class="card10">
        <div class="toggle2">
          <div class="toggle3">
            <div class="frame2"></div>
            <div class="circle2"></div>
          </div>
          <div class="on1">Email group b</div>
        </div>
        <div class="toggle4">
          <div class="toggle3">
            <div class="frame3"></div>
            <div class="circle3"></div>
          </div>
          <div class="on1">Email group A</div>
        </div>
      </div>
      <div id="static_name"class="input">
        <img class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label1">Name</div>
      </div>

      <!-- created an name input tag when edit button is clicked -->
      <div id="input_name"style="display:none;"class="input">
        <input style="color:black;"id="username"type="text"name="username"class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label1">Name</div>
      </div>
<!--  -->
      <div id="static_email"class="input1">
        <img class="rectangle-icon9" alt=""  />

        <div id="default_email"class="input-text1"></div>
        <div class="label2">Email Address</div>
      </div>
      <!--  -->
      <div id="input_email"style="display:none;"class="input1"">
        <input style="color:black;"name="email"type="email" id="email"class="rectangle-icon9" alt="" />

        <div id="default_name" class="input-text1"></div>
        <div class="label2">Email Address</div>
      </div>

      <!--  -->
      <div class="input2">
        <img class="rectangle-icon9" alt=""  />

        <div  class="input-text1">***********</div>
        <div class="label2">Password</div>
      </div>
      <div class="name">Name</div>
      
      <div id="edit_name" class="button7 ">
        
        <div  class="update-property">Edit </div>
      </div>
      <div  id="liveToastBtn"  onclick="onSubmitName()" style="display:none;" class="submit_name button7">
        <div  class="update-property-submit">Submit </div>
      </div>
      <a onclick="passwordReset();" href="./password-reset1.html">

      <div class="button8">
        <div class="update-property">Reset</div>
      </div></a>
      <div id="edit_email" class="button9">
        <div class="update-property">Edit </div>
      </div>
      <div  id="liveToastBtn1"  onclick="onSubmitEmail()" style="display:none;"  class="submit_email button9">
        <div  class="update-property-submit">Submit</div>
      </div>
    </div>
    <script>
      var default_name=document.getElementById('default_name')
      var default_email=document.getElementById("default_email")
      var curName=window.localStorage.getItem('username')
      var curEmail=window.localStorage.getItem('user_email')
      default_name.textContent=curName
      default_email.textContent=curEmail


      var edit_name=document.getElementById('edit_name')
      var edit_email=document.getElementById('edit_email')

      var static_name=document.getElementById('static_name')
      var input_name=document.getElementById('input_name')
      var static_email=document.getElementById('static_email')
      var input_email=document.getElementById('input_email')
      var submit_name=document.querySelector('.submit_name')
      var submit_email=document.querySelector('.submit_email')
      var username=document.getElementById("username")
      var email=document.getElementById("email")
      username.value=curName
      email.value=curEmail
      edit_name.addEventListener('click',function(){
        input_name.style.display='block'
        static_name.style.display='none'
        edit_name.style.display='none'
        submit_name.style.display='block'
      
      })
      edit_email.addEventListener('click',function(){
        input_email.style.display='block'
        static_email.style.display='none'
        edit_email.style.display='none'
        submit_email.style.display='block'
      
      })
      function onSubmitEmail(){
        var currentemail =window.localStorage.getItem('user_email')
        var newEmail=email.value
       
    $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/edit_email/',
    data: {'newemail':newEmail,'user_email':currentemail},
    dataType: "text",
    success: function (response) {
      
      parse_response = $.parseJSON(response)
      
      success=parse_response['success']
     if (!success){
      document.getElementById("toastbody").textContent = "Some Error: "+parse_response['msg']
            document.getElementById("toastbody").classList.add("text-danger");
      return 
     }
     document.getElementById("toastbody").textContent = "Successfully Email updated"
            document.getElementById("toastbody").classList.add("text-success")
     
     user_email = parse_response["user_email"]
            
window.localStorage.setItem('user_email',user_email)
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
        
        document.getElementById("toastbody").textContent = "Some Error: "+msg
            document.getElementById("toastbody").classList.add("text-danger");
    }
    
});
      }
      function onSubmitName(){
        var currentuser=window.localStorage.getItem('username')
        var newusername=username.value
        
 
    $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/edit_name/',
    data: {'newusername':newusername,'username':currentuser},
    dataType: "text",
    success: function (response) {
      parse_response = $.parseJSON(response)
      console.log(parse_response)
      success=parse_response['success']
     if (!success){
      document.getElementById("toastbody").textContent = "Some Error: "+parse_response['msg']
            document.getElementById("toastbody").classList.add("text-danger");  
                return 
     }
     document.getElementById("toastbody").textContent = "Successfully updated username"
     document.getElementById("toastbody").classList.add("text-success")

      username = parse_response["username"]
      window.localStorage.setItem('username',username)
    
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
        document.getElementById("toastbody").textContent = "Some Error: "+msg
            document.getElementById("toastbody").classList.add("text-danger");
    }
    
});
      }

      function onDelete(){
var password=$("#password").val()
var confirmpassword=$("#confirmpassword").val()
        $.ajax({
    type: 'POST',
    url:  'http://127.0.0.1:8000/custom/delete/',
    data: {'email':window.localStorage.getItem('user_email'),'password':password,'confirm_password':confirmpassword},
    dataType: "text",
    success: function (response) {
      parse_response = $.parseJSON(response)
      console.log(parse_response)
      success=parse_response['success']
     if (!success){
      document.getElementById("toastbody").textContent = "Some Error: "+parse_response['msg']
            document.getElementById("toastbody").classList.add("text-danger");
      return 
     }
     document.getElementById("toastbody").textContent = "Successfully deleted your account"
            document.getElementById("toastbody").classList.add("text-success")

      window.localStorage.clear()
      window.location.replace('/')
    },
    error: function (jqXHR, exception) {
       // document.getElementById("login_id").value = "Login"
        var msg = '';
        if (jqXHR.status === 0) {
            msg = 'Server is down, please wait.';
        } else if (jqXHR.status == 401) {
            msg = 'Wrong username or password.'; 
        } else if (jqXHR.status == 404) {
            msg = 'Requested page not found. [404]';
        } else if (jqXHR.status == 500) {
            msg = 'Internal Server Error [500].';
        } else if (exception === 'parsererror') {
            msg = 'Requested JSON parse failed.';
        } else if (exception === 'timeout') {
            msg = 'Time out error.';
        } else if (exception === 'abort') {
            msg = 'Ajax request aborted.';
        } else {
            msg = 'Uncaught Error.\n' + jqXHR.responseText;
        }
        document.getElementById("toastbody").textContent = "Some Error: "+msg
            document.getElementById("toastbody").classList.add("text-danger");
    }
    
});
      }
    </script>
    <script>// Get the modal
      var modal = document.getElementById("myModal");
      
      // Get the button that opens the modal
      var btn = document.getElementById("myBtn");
      
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];
      
      // When the user clicks on the button, open the modal
      btn.onclick = function() {
        modal.style.display = "block";
      }
      
      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
        modal.style.display = "none";
      }
      
      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      } </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
        <script>
        const toastTrigger = document.getElementById('liveToastBtn')
        const toastTrigger1=document.getElementById('liveToastBtn1')
        const toastTrigger2=document.getElementById('liveToastBtn2')

        const toastLiveExample = document.getElementById('liveToast')
        
        if (toastTrigger1) {
          const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
          toastTrigger1.addEventListener('click', () => {
            toastBootstrap.show()
          })

        }
        if (toastTrigger) {
          const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
          toastTrigger.addEventListener('click', () => {
            toastBootstrap.show()
          })}
          if (toastTrigger2) {
          const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
          toastTrigger2.addEventListener('click', () => {
            toastBootstrap.show()
          })}
        </script> 

      </body>
</html>
